<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 1 Join is an overlap | Tidy Ranges Tutorial</title>
  <meta name="description" content="Basic examples of computing operations on genomic ranges using the
tidy data philosophy." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 1 Join is an overlap | Tidy Ranges Tutorial" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Basic examples of computing operations on genomic ranges using the
tidy data philosophy." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 1 Join is an overlap | Tidy Ranges Tutorial" />
  
  <meta name="twitter:description" content="Basic examples of computing operations on genomic ranges using the
tidy data philosophy." />
  

<meta name="author" content="nullranges devel team" />


<meta name="date" content="2021-11-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="overlap-granges-with-plyranges.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Tidy Ranges Tutorial</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="1" data-path="join-is-an-overlap.html"><a href="join-is-an-overlap.html"><i class="fa fa-check"></i><b>1</b> Join is an overlap</a></li>
<li class="chapter" data-level="2" data-path="overlap-granges-with-plyranges.html"><a href="overlap-granges-with-plyranges.html"><i class="fa fa-check"></i><b>2</b> Overlap GRanges with plyranges</a></li>
<li class="chapter" data-level="3" data-path="tissue-specific-promoter-marks.html"><a href="tissue-specific-promoter-marks.html"><i class="fa fa-check"></i><b>3</b> Tissue-specific promoter marks</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Tidy Ranges Tutorial</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="join-is-an-overlap" class="section level1">
<h1><span class="header-section-number">Chapter 1</span> Join is an overlap</h1>
<p>Objective: learn that a “join” is like an overlap.</p>
<p>We start with a quick example explaining why we use functions called
<code>join</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">library</span>(randomNames)</a></code></pre></div>
<p>Let’s set up a simulation where we have 17 classmates (not counting
ourselves) in a school of 118. Suppose every member of the class has
12 friends outside of class.</p>
<p>We want to find out, for each classmate, how many friends we have in
common and also, of our shared friends, what is a typical birthday.
Let’s define typical as the median birthday of our shared friends.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">m &lt;-<span class="st"> </span><span class="dv">17</span> <span class="co"># size of class</span></a>
<a class="sourceLine" id="cb2-2" title="2">n &lt;-<span class="st"> </span><span class="dv">100</span> <span class="co"># size of others in school</span></a>
<a class="sourceLine" id="cb2-3" title="3">nf &lt;-<span class="st"> </span><span class="dv">12</span> <span class="co"># number of friends outside class</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="kw">set.seed</span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb2-5" title="5">people &lt;-<span class="st"> </span><span class="kw">randomNames</span>(m <span class="op">+</span><span class="st"> </span>n,</a>
<a class="sourceLine" id="cb2-6" title="6">                      <span class="dt">name.order=</span><span class="st">&quot;first.last&quot;</span>,</a>
<a class="sourceLine" id="cb2-7" title="7">                      <span class="dt">name.sep=</span><span class="st">&quot; &quot;</span>)</a></code></pre></div>
<p>We define the population of potential friends (those outside the
class) as <code>pop</code>, and our 12 friends are in <code>friends</code>. Finally, we
define the people that are in our class as <code>class_people</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">pop &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">person=</span>people[<span class="op">-</span>(<span class="dv">1</span><span class="op">:</span>m)],</a>
<a class="sourceLine" id="cb3-2" title="2">                  <span class="dt">birthday=</span><span class="kw">sample</span>(<span class="dv">31</span>, n, <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb3-3" title="3">friends &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">friend=</span><span class="kw">sample</span>(people, nf))</a>
<a class="sourceLine" id="cb3-4" title="4">class_people &lt;-<span class="st"> </span>people[<span class="dv">1</span><span class="op">:</span>m]</a></code></pre></div>
<p>The following sets up a data.frame, where each row gives, for a given
classmate, their friends, and the friends’ birthdays.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">loop &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span>m, <span class="dt">each=</span>nf)</a>
<a class="sourceLine" id="cb4-2" title="2">idx &lt;-<span class="st"> </span><span class="kw">as.vector</span>(<span class="kw">replicate</span>(m, <span class="kw">sample</span>(n, nf)))</a>
<a class="sourceLine" id="cb4-3" title="3">class &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">classmate=</span>class_people[loop],</a>
<a class="sourceLine" id="cb4-4" title="4">                    <span class="dt">friend=</span>pop<span class="op">$</span>person[idx],</a>
<a class="sourceLine" id="cb4-5" title="5">                    <span class="dt">birthday=</span>pop<span class="op">$</span>birthday[idx])</a></code></pre></div>
<p>Sort this by classmate alphabetically, and make classmate into a
factor. This last step is important, as it will help us to keep track
of the classmates for whom we share <em>no</em> friends outside of class.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">class &lt;-<span class="st"> </span>class <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="st">  </span><span class="kw">arrange</span>(classmate) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">classmate=</span><span class="kw">factor</span>(classmate))</a></code></pre></div>
<p>We perform an <code>inner_join</code> by <code>"friend"</code>. This just means we look for
classmates where we have overlapping friends, and we drop the rows
where we don’t share any friends. “Inner” refers to the fact that we
are keeping the overlap in the <em>inside</em> of two intersecting circles.
Note that the join operation brings along the metadata (extra data)
about the friends’ birthdays.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">shared_friends &lt;-<span class="st"> </span>friends <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="st">  </span><span class="kw">inner_join</span>(class, <span class="dt">by=</span><span class="st">&quot;friend&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="st">  </span><span class="kw">arrange</span>(classmate, friend) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="st">  </span><span class="kw">relocate</span>(classmate) <span class="co"># classmate to 1st column</span></a>
<a class="sourceLine" id="cb6-5" title="5">shared_friends</a></code></pre></div>
<pre><code>##                classmate             friend birthday
## 1          Brandon Jones Christopher Rivera       13
## 2          Brandon Jones       Jose Jimenez       26
## 3          Brandon Jones    Maria Hernandez       15
## 4          Brandon Jones         Tuli Hoang        7
## 5     Christopher Herron         Tuli Hoang        7
## 6     Christopher Herron  William Steinbach       15
## 7         Haley Polhamus   Cellene Millhone       23
## 8         Haley Polhamus  William Steinbach       15
## 9  Juan Villegas Cabrera     Alyssa Kinanee       30
## 10 Juan Villegas Cabrera       Malik Gammon        5
## 11 Juan Villegas Cabrera     Tajhae Bohanna       31
## 12     Maisara el-Arshad     Kaylyn Judkins        2
## 13     Maisara el-Arshad    Maria Hernandez       15
## 14     Maisara el-Arshad     Tajhae Bohanna       31
## 15        Michael Mcgill Christopher Rivera       13
## 16        Michael Mcgill    Maria Hernandez       15
## 17        Noah Pettinger     Kaylyn Judkins        2
## 18        Noah Pettinger     Tajhae Bohanna       31
## 19         Orion Villani       Malik Gammon        5
## 20         Shane Ranaldi     Alyssa Kinanee       30
## 21         Shane Ranaldi  William Steinbach       15
## 22   Stephanie Hernandez Asmaa el-Abdelnour       29
## 23   Zachary Roe-Huffman    Maria Hernandez       15</code></pre>
<p>Lastly, we perform some summarization: compute the number of friends
in common with <code>n()</code> and the median birthday of shared friends. The
<code>complete</code> call at the end fills in 0 for those classmates for
whom we share no friends (here, the use of <code>factor</code> earlier becomes
relevant).</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">shared_friends <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(classmate) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">in_common=</span><span class="kw">n</span>(), <span class="dt">median_bday=</span><span class="kw">median</span>(birthday)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="st">  </span><span class="kw">complete</span>(classmate, <span class="dt">fill=</span><span class="kw">list</span>(<span class="dt">count=</span><span class="dv">0</span>))</a></code></pre></div>
<pre><code>## # A tibble: 17 × 3
##    classmate             in_common median_bday
##    &lt;fct&gt;                     &lt;int&gt;       &lt;dbl&gt;
##  1 Aaliyah Minter               NA        NA  
##  2 Brandon Jones                 4        14  
##  3 Christopher Herron            2        11  
##  4 Collin Leon                  NA        NA  
##  5 Haley Polhamus                2        19  
##  6 Juan Villegas Cabrera         3        30  
##  7 Khaalid el-Ammar             NA        NA  
##  8 Kianna Mcalevy               NA        NA  
##  9 Maazin al-Ismael             NA        NA  
## 10 Maisara el-Arshad             3        15  
## 11 Michael Mcgill                2        14  
## 12 Noah Pettinger                2        16.5
## 13 Orion Villani                 1         5  
## 14 Shane Ranaldi                 2        22.5
## 15 Stephanie Hernandez           1        29  
## 16 Xavier Urueta                NA        NA  
## 17 Zachary Roe-Huffman           1        15</code></pre>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="overlap-granges-with-plyranges.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["tidy-ranges-tutorial.pdf", "tidy-ranges-tutorial.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
