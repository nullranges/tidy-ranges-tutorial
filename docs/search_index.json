[["tissue-specific-promoter-marks.html", "Chapter 3 Tissue-specific promoter marks", " Chapter 3 Tissue-specific promoter marks Objective: determine if promoters marks (e.g. H3K27ac) are specific to genes that are expressed in a tissue-specific manner. We will load expression data from the GTEx project, which gives median expression in TPM for each tissue. library(tidyr) gtex &lt;- read.delim(&quot;data/GTEx_Analysis_2017-06-05_v8_RNASeQCv1.1.9_gene_median_tpm.gct.gz&quot;, skip=2) We select two tissues, bladder and kidney, and convert the data from a wide format into a tidy format. tissues &lt;- gtex %&gt;% dplyr::select(Name, Bladder, Kidney...Cortex) %&gt;% dplyr::rename(gene = Name, Kidney = Kidney...Cortex) %&gt;% dplyr::mutate(gene = sub(&quot;\\\\..*&quot;,&quot;&quot;,gene)) %&gt;% pivot_longer(!gene, names_to=&quot;tissue&quot;, values_to=&quot;tpm&quot;) Now define two vectors of genes that are specific to bladder and kidney: bladder_expr &lt;- tissues %&gt;% dplyr::filter(tissue == &quot;Bladder&quot; &amp; tpm &gt; 10) %&gt;% dplyr::pull(gene) kidney_expr &lt;- tissues %&gt;% dplyr::filter(tissue == &quot;Kidney&quot; &amp; tpm &gt; 10) %&gt;% dplyr::pull(gene) int &lt;- intersect(bladder_expr, kidney_expr) bladder_expr &lt;- setdiff(bladder_expr, int) kidney_expr &lt;- setdiff(kidney_expr, int) Next, use an existing TxDb to locate these genes in the genomes. While we usually recommend to use GENCODE genes for human analysis, because the ENCODE chromatin modification peak files on AnnotationHub are in hg19, we use the UCSC hg19 genes here for simplicity of the code: library(TxDb.Hsapiens.UCSC.hg19.knownGene) library(org.Hs.eg.db) Add the ENSEMBL ID and pull out the two tissue-specific sets. g &lt;- genes(TxDb.Hsapiens.UCSC.hg19.knownGene) ## 403 genes were dropped because they have exons located on both strands ## of the same reference sequence or on more than one reference sequence, ## so cannot be represented by a single genomic range. ## Use &#39;single.strand.genes.only=FALSE&#39; to get all the genes in a ## GRangesList object, or use suppressMessages() to suppress this message. library(plyranges) g &lt;- g %&gt;% mutate(ensembl = mapIds(org.Hs.eg.db, gene_id, &quot;ENSEMBL&quot;, &quot;ENTREZID&quot;)) bladder_g &lt;- g %&gt;% filter(ensembl %in% bladder_expr) kidney_g &lt;- g %&gt;% filter(ensembl %in% kidney_expr) Finally we combine the two sets with bind_ranges, and we change the feature size from the whole gene extent (the range from the leftmost exon to rightmost exon), to just the TSS, using anchor_5p and mutate. tss &lt;- bind_ranges(bladder=bladder_g, kidney=kidney_g, .id=&quot;gtissue&quot;) %&gt;% anchor_5p() %&gt;% mutate(width=1) Now we will obtain the H3K27ac peak sets: library(AnnotationHub) ah &lt;- AnnotationHub() We download these and scale so they have the same 90% quantile of signalValue. # query(ah, c(&quot;Homo sapiens&quot;, &quot;bladder&quot;, &quot;H3K27ac&quot;, &quot;narrowPeak&quot;)) bladder_pks &lt;- ah[[&quot;AH44180&quot;]] ## loading from cache ## require(&quot;rtracklayer&quot;) bladder_pks &lt;- bladder_pks %&gt;% mutate(signalValue = signalValue / quantile(signalValue, .9)[[1]]) # query(ah, c(&quot;Homo sapiens&quot;, &quot;kidney&quot;, &quot;H3K27ac&quot;, &quot;narrowPeak&quot;)) kidney_pks &lt;- ah[[&quot;AH43443&quot;]] ## loading from cache kidney_pks &lt;- kidney_pks %&gt;% mutate(signalValue = signalValue / quantile(signalValue, .9)[[1]]) Combine the peaks from bladder and kidney, filter to those with &lt; 0.1% FDR, and center the peak on the summit (the peak column gives the shift from the left side to the summit). pks &lt;- bind_ranges(bladder=bladder_pks, kidney=kidney_pks, .id=&quot;ptissue&quot;) %&gt;% filter(qValue &gt; 3, width &lt;= 1000) %&gt;% mutate(start = start + peak) %&gt;% select(-peak) %&gt;% mutate(width = 1) Finally, once we have two tidy range sets, the plyranges analysis is just a few lines: tss %&gt;% join_overlap_left(pks, maxgap=500) %&gt;% group_by(gtissue, ptissue) %&gt;% summarize(count = n(), meanSignal = mean(signalValue)) ## DataFrame with 6 rows and 4 columns ## gtissue ptissue count meanSignal ## &lt;Rle&gt; &lt;character&gt; &lt;integer&gt; &lt;numeric&gt; ## 1 bladder bladder 3065 1.182096 ## 2 bladder kidney 2100 0.919537 ## 3 bladder NA 862 NA ## 4 kidney bladder 131 0.985926 ## 5 kidney kidney 261 0.712519 ## 6 kidney NA 243 NA What’s wrong with this analysis? We didn’t figure out the expressed promoter, we just looked at the left or rightmost isoform (for + or - strand genes, respectively). "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
