[["bootstrap-overlap.html", "Chapter 4 Bootstrap overlap", " Chapter 4 Bootstrap overlap Objective: library(AnnotationHub) ah &lt;- AnnotationHub() kidney_pks &lt;- ah[[&quot;AH43443&quot;]] bladder_pks &lt;- ah[[&quot;AH44180&quot;]] # hg19.Crawford.wgEncodeDukeMapabilityRegionsExcludable query(ah, c(&quot;excluderanges&quot;,&quot;hg19&quot;)) ## AnnotationHub with 12 records ## # snapshotDate(): 2021-10-20 ## # $dataprovider: UCSC, ENCODE ## # $species: Homo sapiens ## # $rdataclass: GRanges ## # additional mcols(): taxonomyid, genome, description, ## # coordinate_1_based, maintainer, rdatadateadded, preparerclass, tags, ## # rdatapath, sourceurl, sourcetype ## # retrieve records with, e.g., &#39;object[[&quot;AH95910&quot;]]&#39; ## ## title ## AH95910 | hg19.Bernstein.Mint_Excludable_hg19.rds ## AH95911 | hg19.Birney.wgEncodeDacMapabilityConsensusExcludable.rds ## AH95912 | hg19.Crawford.wgEncodeDukeMapabilityRegionsExcludable.rds ## AH95913 | hg19.Wold.hg19mitoExcludable.rds ## AH95914 | hg19.Yeo.eCLIP_Excludableregions.hg19.rds ## ... ... ## AH95929 | hg19.UCSC.contig.rds ## AH95930 | hg19.UCSC.heterochromatin.rds ## AH95931 | hg19.UCSC.scaffold.rds ## AH95932 | hg19.UCSC.short_arm.rds ## AH95933 | hg19.UCSC.telomere.rds exclude &lt;- ah[[&quot;AH95912&quot;]] ## loading from cache x &lt;- kidney_pks y &lt;- bladder_pks x &lt;- keepStandardChromosomes(x) seqlevels(x, pruning.mode=&quot;coarse&quot;) &lt;- setdiff(seqlevels(x), &quot;chrM&quot;) seqlevels(y, pruning.mode=&quot;coarse&quot;) &lt;- seqlevels(x) seqlevels(exclude, pruning.mode=&quot;coarse&quot;) &lt;- seqlevels(x) library(plyranges) exclude &lt;- exclude %&gt;% filter(width(exclude) &gt;= 500) q_thr &lt;- 4 s_thr &lt;- 10 x &lt;- x %&gt;% filter(qValue &gt; q_thr &amp; signalValue &gt; s_thr) %&gt;% sort() y &lt;- y %&gt;% filter(qValue &gt; q_thr &amp; signalValue &gt; s_thr) %&gt;% sort() obs &lt;- x %&gt;% mutate(n_overlaps = count_overlaps(., y)) obs %&gt;% summarize(sum = sum(n_overlaps)) ## DataFrame with 1 row and 1 column ## sum ## &lt;integer&gt; ## 1 3776 table( obs$n_overlaps ) ## ## 0 1 2 3 4 ## 7863 3075 315 21 2 y %&gt;% mutate(n_overlaps = count_overlaps(., exclude)) %&gt;% summarize(sum = sum(n_overlaps)) ## DataFrame with 1 row and 1 column ## sum ## &lt;integer&gt; ## 1 0 library(nullranges) R &lt;- 100 # number of iterations pks_to_boot &lt;- y %&gt;% mutate(id=seq_len(length(peak))) %&gt;% select(id) set.seed(5) boots &lt;- bootRanges(pks_to_boot, blockLength=5e5, R=R, exclude=exclude) examine properties of permuted ‘y’ over iterations stats &lt;- boots %&gt;% group_by(iter) %&gt;% summarize(n = n(), sum_width=sum(width)/1e6) %&gt;% as.data.frame() summary(stats) ## iter n sum_width ## 1 : 1 Min. :4110 Min. :3.741 ## 2 : 1 1st Qu.:4252 1st Qu.:3.910 ## 3 : 1 Median :4318 Median :3.996 ## 4 : 1 Mean :4328 Mean :3.987 ## 5 : 1 3rd Qu.:4399 3rd Qu.:4.066 ## 6 : 1 Max. :4608 Max. :4.241 ## (Other):94 detail of how we count hits, an ID of NA = no hit counter &lt;- function(id) sum(!is.na(id)) library(tidyr) null &lt;- x %&gt;% join_overlap_left(boots) %&gt;% group_by(iter) %&gt;% summarize(n_overlaps=counter(id)) %&gt;% as.data.frame() %&gt;% complete(iter, fill=list(rate=0)) %&gt;% drop_na() head(null) ## # A tibble: 6 × 2 ## iter n_overlaps ## &lt;fct&gt; &lt;int&gt; ## 1 1 37 ## 2 2 36 ## 3 3 46 ## 4 4 27 ## 5 5 29 ## 6 6 41 obs_overlaps &lt;- sum(obs$n_overlaps) # the observed count of overlaps obs_overlaps ## [1] 3776 library(ggplot2) ggplot(null, aes(n_overlaps)) + geom_histogram(binwidth=5) + ggtitle(&quot;bootstrap overlaps&quot;) "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
